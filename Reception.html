<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./ALL_CSS_FILE/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="./bootstrap-5.0.2-dist/css/bootstrap.min.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="ALL_JAVA_SCRIPT_FILE/api.js"></script>
    <script src="jquery.min.js"></script>
    <script src="ALL_JAVA_SCRIPT_FILE/cookie.js"></script>
    <title>Document</title>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary  ">
        <div class="container-fluid align-items-center">
            <!-- nav bar logo image code strat  -->
            <a class="navbar-brand" href="#">Hopshee</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- nav bar logo image code complete -->
            <!-- nav bar page menu code start -->
            <div class="collapse navbar-collapse justify-content-between" id="collapsibleNavbar">
                <!-- <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="index.html">Deshbord</a>
                    </li>
                     nev bar drop down menu text1 code start 
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-white" href="#" role="button"
                            data-bs-toggle="dropdown">Doctor</a>
                        <ul class="dropdown-menu bg-primary">
                            <li><a class="dropdown-item text-white" href="All_Doctor.html">All-Doctor</a></li>
                            <li><a class="dropdown-item text-white" href="Add_Doctor.html">Add-doctor</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-white" href="#" role="button"
                            data-bs-toggle="dropdown">Patient</a>
                        <ul class="dropdown-menu bg-primary">
                            <li><a class="dropdown-item text-white" href="All_patient.html">All-Patient</a></li>
                    </li> -->
                </ul>
                </li>
                <!-- nev bar drop down menu text1 code finsh-->
                <!-- nev bar drop down menu text3 code start -->
                <!-- <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-white" href="#" role="button"
                            data-bs-toggle="dropdown">Doctor
                            Sidual</a>
                        <ul class="dropdown-menu bg-primary">
                            <li><a class="dropdown-item text-white" href="#">Add-Docotr-Sidual</a></li>
                            <li><a class="dropdown-item text-white" href="#">Edit-Patient-Sidual</a></li>
                        </ul>
                    </li> -->
                <!-- nev bar drop down menu text3 code finsh -->
                </ul>
                <button style="background-color: transparent; border: transparent; color: white;"
                    id="Logout">Logout</button>
                <!-- nav bar page menu code finsh  -->
                <!-- nav bar code icon  -->
                <!-- <div class="d-flex col-md-2 justify-content-around align-items-center">
                    <a href="#" class="text-white  nav-icon iconClass"><i class="fa-regular fa-bell"
                            style="font-size: 20px;"></i></a>
                    <a href="#" class="text-white"><i class="fa-regular fa-envelope" style="font-size: 20px;"></i></a>

                    <div class="dropdown ">
                        <button class="dropdown-toggle btn btn-default" id="menu1" data-bs-toggle="dropdown">
                            <img src="./image/profile.png" alt="" height="30px" class="rounded-pill"></i>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu bg-primary" role="menu" aria-labelledby="menu1">
                            <li class="nav-link"><a class="dropdown-item text-white" href="#">PROFILE</a></li>
                            <li class="divider"></li>
                            <li class="nav-link"><a class="dropdown-item text-white" href="#">SETTING</a></li>
                        </ul>
                    </div>
                </div> -->
                <!-- nav bar icon code finsh  -->
            </div>
        </div>
    </nav>
    <div class="container bg-white pt-4 pb-4">
        <div style="height: 50px; background-color: white;" class="pt-0 px-4 border rounded"> <label
                style="font-size: 30px;">Appointment List</label></div>
        <div class="row mx-0 mt-2 border pt-2 pb-2 shadow-sm">
            <div class="col-1">AID</div>
            <div class="col-3">USER NAME</div>
            <div class="col-3">DOCTOR NAME</div>
            <div class="col-2">APPOINTMENT-DATE</div>
            <div class="col-2">APPOINTMENT-TIME</div>
            <div class="col-1">ADD</div>
        </div>
        <!-- Table body where appointment data will be populated -->
        <div id="appointmentList"></div>
    </div>
    <script src="./bootstrap-5.0.2-dist/js/bootstrap.bundle.js"></script>
    <script>
        $(document).ready(function () {
            const eid = getCookie('employee_id');
            if (eid != null && eid.length > 0) {
                // alert(eid);
            } else {
                // window.location.replace("login.html");
            }
            // Define API URLs
            const appointmentAPI = `${appoinments}?is_hospital_visit=0`;
            console.log(appointmentAPI);
            const userAPI = users;
            const doctorAPI = doctors;

            // Function to fetch user data based on user ID
            function getUserData(userID, callback) {
                $.ajax({
                    url: userAPI + '/' + userID,
                    method: 'GET',
                    dataType: 'json',
                    success: function (userData) {
                        callback(userData);
                    },
                    error: function (error) {
                        console.error('Error fetching user data: ' + error);
                        callback(null); // Call the callback with null in case of an error
                    }
                });
            }

            // Function to fetch doctor data based on doctor ID
            function getDoctorData(doctorID, callback) {
                $.ajax({
                    url: doctorAPI + '/' + doctorID,
                    method: 'GET',
                    dataType: 'json',
                    success: function (doctorData) {
                        callback(doctorData);
                    },
                    error: function (error) {
                        console.error('Error fetching doctor data: ' + error);
                        callback(null);
                    }
                });
            }

            function formatDate(dateString) {
                const date = new Date(dateString);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0'); // Add 1 to month since it's zero-based
                const day = String(date.getDate()).padStart(2, '0');
                const formattedDate = `${year}/${month}/${day}`;
                return formattedDate;
            }

            function populateAppointmentList() {
                $.ajax({
                    url: appointmentAPI,
                    method: 'GET',
                    dataType: 'json',
                    success: function (appointmentData) {
                        console.log(appointmentData);
                        $.each(appointmentData.data, function (index, appointment) {
                            getUserData(appointment.user_id, function (userData) {
                                getDoctorData(appointment.doctor_id, function (doctorData) {
                                    // Create a new row and populate it with appointment, user, and doctor data
                                    var newRow = $('<div class="row mx-0 mt-2 border pt-2 pb-2 shadow-sm"></div>');
                                    newRow.append('<div class="col-1">' + appointment.appo_id + '</div>');
                                    newRow.append('<div class="col-3">' + (userData ? userData.data[0].user_name : 'N/A') + '</div>');
                                    newRow.append('<div class="col-3">' + (doctorData ? doctorData.data[0].doctor_name : 'N/A') + '</div>');
                                    newRow.append('<div class="col-2">' + formatDate(appointment.appo_dt) + '</div>');
                                    newRow.append('<div class="col-2">' + appointment.appo_time + '</div>');
                                    // Create a button for ADD with a click event to redirect
                                    var addButton = $('<div class="col-1"><button style="background: none; border: none;"><i class="fa-regular fa-pen-to-square"></i></button></div>');
                                    addButton.find('button').click(function () {
                                        redirectToAddPage(appointment.user_id, appointment.appo_id);
                                    });
                                    newRow.append(addButton);

                                    // Append the row to the appointment list
                                    $('#appointmentList').append(newRow);
                                });
                            });
                        });
                    },
                    error: function (error) {
                        console.log('Error fetching appointment data: ' + error);
                    }
                });
            }

            // Function to redirect to the new page with user ID and doctor ID
            function redirectToAddPage(userId, appoId) {
                // Construct the URL with user_id and doctor_id as query parameters
                const redirectURL = `Add_appoinment.html?user_id=${userId}&appo_id=${appoId}`;

                // Redirect to the new page
                window.location.href = redirectURL;
            }

            // Call the function to populate the appointment list
            populateAppointmentList();
            $("#Logout").click(function () {
                console.log("Logout");
                setCookie("admin_id", "", 1);
                setCookie('employee_id', "", 1);
                window.location.replace("login.html");
            });
        });
    </script>

</body>

</html>